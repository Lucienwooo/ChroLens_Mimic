# ChroLens_Mimic 發布檢查清單

## 為什麼需要這個檢查清單？

**問題根源：** 更新系統失敗的主要原因是**手動發布流程不一致**，導致：
- Tag 命名格式不統一（有時是 `v2.7.1`，有時是 `2.7.1`）
- Zip 檔案命名不符合預期格式（必須是 `ChroLens_Mimic_{版本號}.zip`）
- 忘記上傳更新包或上傳錯誤的檔案
- 版本號在不同檔案中不一致

**解決方案：** 標準化發布流程，確保每次發布都遵循相同步驟。

---

## 發布前準備（必須完成）

### 1. 版本號統一檢查
- [ ] `ChroLens_Mimic.py` 中的 `VERSION` 變數已更新
- [ ] `version_info.txt` 中的版本號已更新
- [ ] `pack_safe.py` 中的 `self.version` 已更新
- [ ] `docs/index.html` 更新日誌中的版本號已更新

**驗證命令：**
```powershell
python validate_release.py --check-version
```

### 2. 更新說明準備
- [ ] 在 `docs/index.html` 中新增本版本的更新說明
- [ ] 準備 GitHub Release 的更新說明（可從 index.html 複製）
- [ ] 確認更新內容包含：
  - 新功能
  - 改進項目
  - 錯誤修復

### 3. 程式碼測試
- [ ] 執行基本功能測試
- [ ] 測試新增功能是否正常運作
- [ ] 確認沒有明顯的錯誤或崩潰

---

## 打包流程（必須按順序）

### 4. 執行打包
```powershell
cd C:\Users\Lucien\Documents\GitHub\ChroLens_Mimic\main
python pack_safe.py
```

**預期結果：**
- 生成 `ChroLens_Mimic_{版本號}.zip`
- 例如：`ChroLens_Mimic_2.7.1.zip`

**檢查項目：**
- [ ] Zip 檔案命名格式正確（`ChroLens_Mimic_X.Y.Z.zip`）
- [ ] Zip 檔案大小合理（通常 30-50 MB）
- [ ] 可以正常解壓縮
- [ ] 包含 `ChroLens_Mimic.exe` 主程式

### 5. 驗證更新包
```powershell
python validate_release.py --check-zip ChroLens_Mimic_2.7.1.zip
```

---

## GitHub Release 發布（關鍵步驟）

### 6. 創建 Release
1. 前往 https://github.com/Lucienwooo/ChroLens_Mimic/releases/new
2. **Tag 版本格式（重要）：**
   - ✅ 推薦格式：`v2.7.1`（帶 v 前綴，更新管理器會自動處理）
   - ⚠️ 也支援：`2.7.1`（不帶 v）
   - ❌ 錯誤格式：`V2.7.1`, `version-2.7.1`, `release_2.7.1`

3. **Release 標題：**
   - 格式：`ChroLens_Mimic v2.7.1 - {主要更新簡述}`
   - 例如：`ChroLens_Mimic v2.7.1 - 進階邏輯增強`

4. **上傳檔案（關鍵）：**
   - [ ] 上傳 `ChroLens_Mimic_2.7.1.zip`
   - [ ] **確認檔案名稱完全一致**，不要手動改名
   - [ ] 檔案命名必須符合格式：`ChroLens_Mimic_{版本號}.zip`

5. **Release 說明：**
   - 貼上從 `docs/index.html` 準備好的更新說明
   - 包含所有新功能、改進和修復

6. **發布設定：**
   - [ ] 勾選 "Set as the latest release"
   - [ ] 不要勾選 "Set as a pre-release"（除非是測試版）
   - [ ] 點擊 "Publish release"

---

## 發布後驗證（確保成功）

### 7. API 驗證
等待 1-2 分鐘讓 GitHub 更新 API，然後執行：

```powershell
python validate_release.py --check-api
```

**預期結果：**
- ✅ 可以從 GitHub API 取得最新版本
- ✅ Tag 格式正確
- ✅ 找到更新包（.zip 檔案）
- ✅ 檔案名稱符合預期格式

### 8. 舊版本更新測試
1. 找一台電腦或備份的舊版本（例如 2.6.6）
2. 執行程式，點擊「檢查更新」
3. **確認結果：**
   - [ ] 能偵測到新版本 2.7.1
   - [ ] 顯示正確的更新說明
   - [ ] 下載並安裝成功
   - [ ] 更新後版本號正確

---

## 常見問題處理

### Q1: 找不到更新包
**原因：** Zip 檔案命名不符合 `ChroLens_Mimic_{版本號}.zip` 格式
**解決：**
1. 確認打包時的版本號
2. 重新命名 Zip 檔案（或重新打包）
3. 刪除舊的 Release assets，重新上傳

### Q2: 舊版本無法偵測到新版本
**原因：**
- Tag 命名格式錯誤
- 沒有勾選 "Set as the latest release"
- GitHub API 快取未更新

**解決：**
1. 檢查 Release 是否標記為 "Latest"
2. 等待 5 分鐘讓 API 快取更新
3. 用 `validate_release.py --check-api` 驗證

### Q3: 版本號比較錯誤
**原因：** 版本號格式不一致（例如 `2.7.1` vs `2.7.1.0`）
**解決：** 統一使用三段式版本號 `X.Y.Z`

---

## 快速發布指令

完整的自動化發布流程（未來實作）：

```powershell
# 1. 更新版本號（自動修改所有檔案）
python release_helper.py --update-version 2.7.1

# 2. 打包並驗證
python release_helper.py --build-and-validate

# 3. 創建 GitHub Release（需要 GitHub Token）
python release_helper.py --publish --version 2.7.1 --notes "更新說明"
```

---

## 改進建議

### 短期改進（立即可做）
1. ✅ 強化 `update_manager.py` 的檔案匹配邏輯（已完成）
2. ✅ 創建 `validate_release.py` 驗證工具（接下來創建）
3. 每次發布前執行這份檢查清單

### 中期改進（1-2週內）
1. 創建 `release_helper.py` 半自動化工具
   - 自動更新所有檔案中的版本號
   - 自動打包並驗證
   - 產生 Release 說明範本

### 長期改進（1個月內）
1. GitHub Actions 自動化
   - 推送 tag 自動觸發打包
   - 自動創建 Release
   - 自動上傳更新包
2. 自動化測試
   - 版本號一致性檢查
   - 更新流程端到端測試

---

## 版本號規範

### 版本號格式
- 使用語義化版本：`主版本.次版本.修訂號`
- 例如：`2.7.1`

### 版本號升級規則
- **主版本**（2.x.x）：重大架構變更或不相容更新
- **次版本**（x.7.x）：新功能、重大改進
- **修訂號**（x.x.1）：錯誤修復、小改進

### 本次 2.7.1 的定位
- 從 2.8.0 降版到 2.7.1 的原因：
  - 新增的進階邏輯功能屬於「邏輯增強」而非「新特性」
  - 2.8.0 應保留給真正的新功能模組（例如新的 OCR 引擎、雲端同步等）
  - 2.7.1 適合用於「強化現有功能」的更新

---

**最後提醒：** 每次發布前，花 5 分鐘檢查這份清單，可以避免 90% 的更新問題！
