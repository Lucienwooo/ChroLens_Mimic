# 快捷鍵強化功能說明

## 🎯 強化內容

### 之前的問題
❌ 只能捕捉單鍵（F9, F10 等）
❌ 組合鍵顯示不完整（ctrl+c 只顯示 c）
❌ 修飾鍵單獨按下無法顯示
❌ 特殊按鍵無法正確識別

### 現在的改進
✅ **完整捕捉所有組合鍵**
✅ **修飾鍵單獨按下也能顯示**（alt, ctrl, shift, win）
✅ **正確顯示組合鍵格式**（ctrl+c, ctrl+alt+delete）
✅ **支援所有特殊按鍵**（enter, page_up, home 等）
✅ **支援功能鍵**（F1-F24）
✅ **支援方向鍵**（up, down, left, right）
✅ **支援數字鍵盤**（num_0-num_9）

---

## 🔧 強化功能詳解

### 1. 修飾鍵檢測強化

**支援的修飾鍵**：
- `ctrl` - Control 鍵
- `alt` - Alt 鍵
- `shift` - Shift 鍵
- `win` - Windows 鍵

**檢測方式**：
```python
# 同時檢查按鍵狀態和按鍵符號
if event.state & 0x0004 or event.keysym in ('Control_L', 'Control_R'):
    keys.append("ctrl")
```

**單獨按修飾鍵也能顯示**：
- 按下 `Alt` → 顯示 `alt`
- 按下 `Ctrl` → 顯示 `ctrl`
- 按下 `Shift` → 顯示 `shift`

---

### 2. 組合鍵排序規則

**固定順序**：`ctrl` → `alt` → `shift` → `win` → `主鍵`

**範例**：
- `Shift+Ctrl+C` → 自動排序為 `ctrl+shift+c`
- `Alt+F4` → `alt+f4`
- `Ctrl+Alt+Delete` → `ctrl+alt+delete`

---

### 3. 特殊按鍵映射表

| 實際按鍵 | 顯示名稱 | keyboard 模組格式 |
|---------|---------|------------------|
| Enter | `enter` | `enter` |
| Page Up | `page_up` | `page up` |
| Page Down | `page_down` | `page down` |
| Backspace | `backspace` | `backspace` |
| Delete | `delete` | `delete` |
| Insert | `insert` | `insert` |
| Home | `home` | `home` |
| End | `end` | `end` |
| Tab | `tab` | `tab` |
| Escape | `esc` | `esc` |
| Space | `space` | `space` |
| Print Screen | `print_screen` | `print screen` |

---

### 4. 功能鍵支援

**F1-F24 完整支援**：
- `F1`, `F2`, ..., `F12`
- `F13`, `F14`, ..., `F24`（部分鍵盤支援）

**自動識別**：
```python
if key_name.startswith('f') and key_name[1:].isdigit():
    # 自動識別為功能鍵
```

---

### 5. 方向鍵與數字鍵盤

**方向鍵**：
- `up`, `down`, `left`, `right`

**數字鍵盤**：
- `num_0` ~ `num_9`（數字鍵盤的 0-9）
- `num_add`, `num_subtract`, `num_multiply`, `num_divide`
- `num_decimal`, `num_enter`

---

## 📝 使用範例

### 範例 1：設定全域快捷鍵

**步驟**：
1. 點擊「快捷鍵」按鈕
2. 在輸入框中按下想要的組合鍵

**測試案例**：

| 按下按鍵 | 顯示結果 | 說明 |
|---------|---------|------|
| `Ctrl+C` | `ctrl+c` | ✅ 正確 |
| `Alt+F4` | `alt+f4` | ✅ 正確 |
| `Shift+Delete` | `shift+delete` | ✅ 正確 |
| `Ctrl+Alt+T` | `ctrl+alt+t` | ✅ 正確 |
| `Win+D` | `win+d` | ✅ 正確 |
| 只按 `Alt` | `alt` | ✅ 正確（新功能）|
| `F12` | `f12` | ✅ 正確 |
| `Ctrl+Shift+Esc` | `ctrl+shift+esc` | ✅ 正確 |

---

### 範例 2：設定腳本快捷鍵

**步驟**：
1. 切換到「2.腳本設定」頁面
2. 選擇腳本
3. 在「捕捉快捷鍵」輸入框中按下組合鍵
4. 點擊「設定快捷鍵」

**測試案例**：

```
腳本 A → Ctrl+1
腳本 B → Ctrl+2
腳本 C → Alt+Q
腳本 D → Ctrl+Shift+F1
```

**執行**：
- 按 `Ctrl+1` → 自動回放腳本 A
- 按 `Alt+Q` → 自動回放腳本 C

---

## 🔍 技術細節

### 事件檢測改進

**之前**：
```python
# 使用 KeyRelease 事件
entry.bind("<KeyRelease>", handler)
# 問題：無法正確捕捉組合鍵
```

**現在**：
```python
# 使用 KeyPress 事件
entry.bind("<KeyPress>", handler)
# 優點：可以即時捕捉修飾鍵狀態
```

---

### 修飾鍵狀態碼

```python
# Tkinter event.state 位元遮罩
0x0001  # Shift
0x0004  # Ctrl (Control)
0x0008  # Alt (Mod1)
0x0040  # Win (Mod4)
0x20000 # AltGr（右側 Alt）
```

---

### keyboard 模組相容性

強化後的格式完全相容 `keyboard` 模組：

```python
# 內部格式 → keyboard 格式
"ctrl+c"       → keyboard.add_hotkey("ctrl+c", ...)
"alt+f4"       → keyboard.add_hotkey("alt+f4", ...)
"ctrl+shift+a" → keyboard.add_hotkey("ctrl+shift+a", ...)
```

---

## ✅ 測試檢查表

### 基本測試
- [ ] 單一按鍵：`a`, `1`, `f1`
- [ ] 修飾鍵單獨：`ctrl`, `alt`, `shift`, `win`
- [ ] 兩鍵組合：`ctrl+c`, `alt+f4`
- [ ] 三鍵組合：`ctrl+alt+delete`, `ctrl+shift+esc`
- [ ] 四鍵組合：`ctrl+alt+shift+f1`

### 特殊按鍵測試
- [ ] 方向鍵：`up`, `down`, `left`, `right`
- [ ] 功能鍵：`f1`, `f12`, `f24`
- [ ] Page 鍵：`page_up`, `page_down`
- [ ] 編輯鍵：`home`, `end`, `delete`, `backspace`
- [ ] 數字鍵盤：`num_0`, `num_add`

### 實際應用測試
- [ ] 設定快捷鍵後能正確儲存
- [ ] 重新開啟程式後快捷鍵仍有效
- [ ] 按下快捷鍵能正確觸發功能
- [ ] 腳本快捷鍵能正確回放腳本
- [ ] 多個腳本快捷鍵不衝突

---

## 🐛 已知限制

1. **系統保留快捷鍵**
   - ❌ `Ctrl+Alt+Delete`（系統保留）
   - ❌ `Win+L`（系統鎖定）
   - ⚠️ 某些快捷鍵可能被其他程式佔用

2. **特定鍵盤限制**
   - F13-F24 需要鍵盤支援
   - 某些筆電沒有 Win 鍵
   - Mac 鍵盤映射可能不同

3. **組合鍵數量**
   - 理論上支援任意數量修飾鍵
   - 實際可能受限於鍵盤硬體（鍵位衝突）

---

## 💡 使用建議

### 推薦快捷鍵組合

**全域功能**：
```
開始錄製：F10 或 Ctrl+Shift+R
停止：    F9  或 Ctrl+Shift+S
回放：    F12 或 Ctrl+Shift+P
暫停：    F11 或 Ctrl+Shift+Space
```

**腳本快捷鍵**：
```
常用腳本：Ctrl+1, Ctrl+2, Ctrl+3
次要腳本：Alt+Q, Alt+W, Alt+E
特殊腳本：Ctrl+Shift+F1, Ctrl+Shift+F2
```

### 避免衝突

1. **避免與系統快捷鍵衝突**
   - 不用 `Ctrl+C`, `Ctrl+V`（複製貼上）
   - 不用 `Alt+Tab`（切換視窗）
   - 不用 `Win+D`（顯示桌面）

2. **避免與其他軟體衝突**
   - 檢查是否有其他軟體使用相同快捷鍵
   - 可以用 F1-F12 功能鍵（較少衝突）

3. **建議使用**
   - `Ctrl+Shift+字母`（很少衝突）
   - `Alt+數字`（很少衝突）
   - `Ctrl+F1-F12`（很少衝突）

---

## 🎉 總結

這次強化讓快捷鍵系統更加完善：

1. ✅ **所見即所得** - 按下什麼就顯示什麼
2. ✅ **完整支援** - 任何組合鍵都能捕捉
3. ✅ **格式統一** - 自動排序，避免混亂
4. ✅ **相容性佳** - 完全相容 keyboard 模組
5. ✅ **易於使用** - 直接按下即可，無需輸入

現在您可以自由設定任何想要的快捷鍵組合了！🚀
