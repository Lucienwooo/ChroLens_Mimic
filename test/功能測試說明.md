# ChroLens_Mimic 指定視窗功能測試說明

## 修改內容

### 1. UI 調整
- ✅ 將「目標視窗」顯示標籤移到滑鼠座標右邊（橘色文字顯示）
- ✅ 移除腳本選單區的目標視窗標籤（避免重複）

### 2. 視窗選擇功能改進
- ✅ 高亮框設為 **click-through**（滑鼠事件可穿透，不會擋住操作）
- ✅ 高亮框 **2秒後自動消失**
- ✅ 顯示綠色邊框和「✓ 已設定目標視窗」提示文字

### 3. 錄製限定功能
在 `recorder.py` 中新增：
- ✅ `set_target_window(hwnd)` - 設定目標視窗
- ✅ `_is_point_in_target_window(x, y)` - 檢查座標是否在目標視窗內
- ✅ 錄製時只記錄目標視窗內的滑鼠操作（移動、點擊、滾輪）
- ✅ 鍵盤操作不受限制（全域記錄）

### 4. 回放限定功能
- ✅ 回放時會將座標限制在目標視窗範圍內
- ✅ 如果視窗已關閉，則使用原始座標

## 測試步驟

1. **啟動程式**
   ```cmd
   python test2.6.py
   ```

2. **選擇目標視窗**
   - 點擊「選擇目標視窗」按鈕
   - 從列表中選擇一個視窗（例如：記事本、瀏覽器）
   - 會看到綠色邊框閃現 2 秒後自動消失
   - 滑鼠座標右邊會顯示「🎯 視窗名稱」

3. **開始錄製**
   - 按 F10 或點擊「開始錄製」
   - 只在選定的視窗內操作滑鼠
   - 在視窗外的滑鼠操作不會被記錄
   - 鍵盤操作會被記錄（不受視窗限制）

4. **停止並回放**
   - 按 F9 停止錄製
   - 按 F12 開始回放
   - 回放時滑鼠會限制在目標視窗範圍內

5. **清除目標視窗**
   - 再次點擊「選擇目標視窗」
   - 點擊「清除選取」按鈕
   - 目標視窗標籤會清空

## 主要改進點

### 之前的問題
❌ 高亮框會一直停留，擋住視窗無法操作
❌ 沒有實際限制錄製範圍

### 現在的解決方案
✅ 高亮框 2 秒自動消失
✅ 高亮框設為 click-through，不會擋住操作
✅ 錄製時真正過濾視窗外的滑鼠事件
✅ 回放時將座標限制在視窗範圍內
✅ UI 更簡潔，目標視窗顯示在滑鼠座標旁邊

## 技術細節

### 視窗檢測原理
使用 `WindowFromPoint` API 取得滑鼠位置的視窗 handle，然後向上遍歷父視窗，檢查是否匹配目標視窗或其子視窗。

### Click-through 實現
使用 Windows API 設定視窗樣式：
- `WS_EX_LAYERED` (0x00080000) - 支持透明度
- `WS_EX_TRANSPARENT` (0x00000020) - 滑鼠事件穿透

### 座標限制
回放時使用 `GetWindowRect` 取得視窗矩形，將座標 clamp 到視窗範圍內。
